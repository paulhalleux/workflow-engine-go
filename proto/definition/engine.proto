syntax = "proto3";

option go_package = "./proto";

package engine;

import "google/protobuf/empty.proto";
import "google/protobuf/struct.proto";
import "definition/agent.proto";

service TaskService {
  rpc NotifyTaskStatus(NotifyTaskStatusRequest) returns (google.protobuf.Empty);
  rpc NotifyTaskProgress(NotifyTaskProgressRequest) returns (google.protobuf.Empty);
}

service EngineService {
  rpc RegisterAgent(RegisterAgentRequest) returns (RegisterAgentResponse);
  rpc Ping(EnginePingRequest) returns (EnginePingResponse);
  rpc StartWorkflow(StartWorkflowRequest) returns (StartWorkflowResponse);
}

enum AgentProtocol {
  UNKNOWN = 0;
  GRPC = 1;
  HTTP = 2;
}

message EnginePingRequest {
  string name = 1;
}

message EnginePingResponse {
  bool know_agent = 1;
}

message RegisterAgentRequest {
  string name = 1;
  string version = 2;
  optional string address = 3;
  string port = 4;
  AgentProtocol protocol = 5;
  repeated agent.TaskDefinition supported_tasks = 6;
}

message RegisterAgentResponse {
  bool success = 1;
  optional string message = 2;
}

message NotifyTaskStatusRequest {
  string task_id = 1;
  agent.TaskStatus status = 2;
  google.protobuf.Struct output_parameters = 3;
  string message = 4;
}

message NotifyTaskProgressRequest {
  string task_id = 1;
  float progress = 2;
}

message StartWorkflowRequest {
  string workflow_definition_id = 1;
  google.protobuf.Struct input_parameters = 2;
}

message StartWorkflowResponse {
  bool success = 1;
  optional string workflow_instance_id = 2;
  optional string message = 3;
}