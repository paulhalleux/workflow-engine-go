syntax = "proto3";

option go_package = "./proto";

package websocket;

// Websocket Scope

enum WebsocketScopeType {
  WEBSOCKET_SCOPE_TYPE_UNSPECIFIED = 0;
  WEBSOCKET_SCOPE_TYPE_WORKFLOW_INSTANCE = 1;
  WEBSOCKET_SCOPE_TYPE_TASK_INSTANCE = 2;
}

message WebsocketScope {
  WebsocketScopeType type = 1;
  optional string id = 2;
}

// Websocket Message

enum WebsocketMessageType {
  WEBSOCKET_MESSAGE_TYPE_UNSPECIFIED = 0;
  WEBSOCKET_MESSAGE_TYPE_WORKFLOW_INSTANCE_EVENT = 1;
  WEBSOCKET_MESSAGE_TYPE_CLIENT_REGISTERED = 2;
}

message WebsocketMessage {
  WebsocketMessageType type = 1;
  WebsocketScope scope = 2;

  oneof payload {
    WorkflowInstanceEvent workflow_instance_event = 3;
    TaskInstanceEvent task_instance_event = 4;
    ClientRegisteredEvent client_registered_event = 5;
  }
}

// Websocket Command

enum WebsocketCommandType {
  WEBSOCKET_COMMAND_TYPE_UNSPECIFIED = 0;
  WEBSOCKET_COMMAND_TYPE_SUBSCRIBE = 1;
  WEBSOCKET_COMMAND_TYPE_UNSUBSCRIBE = 2;
}

message WebsocketCommand {
  string client_id = 1;
  WebsocketCommandType type = 2;

  oneof command {
    WebsocketSubscribeCommand subscribe_command = 3;
  }
}

message WebsocketSubscribeCommand {
  repeated WebsocketScope scopes = 1;
}

// Workflow Instance Event

enum WorkflowInstanceEventType {
  WORKFLOW_INSTANCE_EVENT_TYPE_UNSPECIFIED = 0;
  WORKFLOW_INSTANCE_EVENT_TYPE_STARTED = 1;
  WORKFLOW_INSTANCE_EVENT_TYPE_UPDATED = 2;
  WORKFLOW_INSTANCE_EVENT_TYPE_COMPLETED = 3;
  WORKFLOW_INSTANCE_EVENT_TYPE_FAILED = 4;
  WORKFLOW_INSTANCE_EVENT_TYPE_CREATED = 5;
}

message WorkflowInstanceEvent {
  string workflow_instance_id = 1;
  WorkflowInstanceEventType event_type = 2;

  oneof details {
    WorkflowInstanceStartedDetails started_details = 3;
    WorkflowInstanceUpdatedDetails updated_details = 4;
    WorkflowInstanceCompletedDetails completed_details = 5;
    WorkflowInstanceFailedDetails failed_details = 6;
    WorkflowInstanceCreatedDetails created_details = 7;
  }
}

message WorkflowInstanceStartedDetails {}
message WorkflowInstanceUpdatedDetails {}
message WorkflowInstanceCompletedDetails {}
message WorkflowInstanceFailedDetails {}
message WorkflowInstanceCreatedDetails {}

// Task Instance Event

enum TaskInstanceEventType {
  TASK_INSTANCE_EVENT_TYPE_UNSPECIFIED = 0;
  TASK_INSTANCE_EVENT_TYPE_STARTED = 1;
  TASK_INSTANCE_EVENT_TYPE_COMPLETED = 2;
  TASK_INSTANCE_EVENT_TYPE_FAILED = 3;
}

message TaskInstanceEvent {
  string task_instance_id = 1;
  TaskInstanceEventType event_type = 2;

  oneof details {
    TaskInstanceStartedDetails started_details = 3;
    TaskInstanceCompletedDetails completed_details = 4;
    TaskInstanceFailedDetails failed_details = 5;
  }
}

message TaskInstanceStartedDetails {}
message TaskInstanceCompletedDetails {}
message TaskInstanceFailedDetails {}

// Registered Message

message ClientRegisteredEvent {
  string client_id = 1;
}